function getUniqueElementName(a){return elementIdCounter+=1,a+"elementId_"+elementIdCounter}function getBaseUrl(a){return pathArray=a.split("/"),host=pathArray[2]}function setServerUrl(a){$("#"+name_txtServerUrl).val(a),btnGetServerInfo_Click(a)}function addFolderToTree(a,b,c){b.create_node(c,{text:a,icon:getItemIcon("Folder","16"),state:{opened:!0},data:{itemType:"Folder",itemUrl:c.data.itemUrl+a+"/",itemName:a,itemJson:void 0}},"last",null,null)}function getItemIcon(a,b){switch(a){case"Folder":case"MapServer":case"FeatureServer":case"GPServer":case"ImageServer":case"MobileServer":case"Server":case"GeocodeServer":case"NAServer":case"GeometryServer":case"Layer":return"img/TreeIcons/treeicon_"+a+"_"+b+".png";default:return"img/TreeIcons/treeicon_other_"+b+".png"}}function getServiceIconFromUrl(a,b){return getItemIcon(getServiceType(a),b)}function getTemplatePath(a){switch(a){case"Folder":return"templates/folderInfo.html";case"GPServer":case"MapServer":case"ImageServer":case"MobileServer":case"FeatureServer":case"NAServer":case"GeocodeServer":case"GeometryServer":case"Layer":return"templates/serviceInfo_"+a+".html";case"Server":return"templates/serviceInfo_Server.html";default:return"templates/serviceInfo.html"}}function getServiceType(a){var b=a.split("/"),c=b[b.length-1];return c}function getServiceNameFromUrl(a){var b=a.split("/");return b[b.length-2]}function getServiceNameFromAgsServiceName(a){var b=a.split("/");return b[b.length-1]}function addServiceToTree(a,b,c){var d=getServiceNameFromAgsServiceName(a.name);b.create_node(c,{text:d+" ("+a.type+")",icon:getItemIcon(a.type,"16"),state:{opened:!0},data:{itemType:a.type,itemUrl:c.data.itemUrl+d+"/"+a.type,itemName:d,itemJson:void 0}},"last",null,null)}function addLayerToTree(a,b,c){b.create_node(c,{text:a.name+" ("+a.id+")",icon:getItemIcon("Layer","16"),state:{opened:!0},data:{itemType:"Layer",itemUrl:c.data.itemUrl+"/"+a.id,itemName:a.name,itemJson:void 0}},"last",null,null)}function writeItemToTree(a,b){try{switch(b.data.itemType){case"Server":case"Folder":b.data.itemJson.folders.forEach(function(c){addFolderToTree(c,a,b)}),b.data.itemJson.services.forEach(function(c){addServiceToTree(c,a,b)});break;case"MapServer":case"FeatureServer":b.data.itemJson.layers.forEach(function(c){addLayerToTree(c,a,b)})}}catch(c){}}function getItemDetails(a,b,c){b.data.itemJson?c():$.getJSON(a+"?f=json&callback=?",function(a){b.data.itemJson=a,c()}).fail(function(){treeObject.delete_node(b),$("#errorDialog").modal()})}function btnGetServerInfo_Click(a){if(a){a.endsWith("/")||(a+="/");var b=getBaseUrl(a),c=treeObject.create_node("#",{text:b,icon:getItemIcon("Server","16"),state:{opened:!0},data:{itemType:"Server",itemUrl:a,itemName:b,itemJson:void 0}},"last",null,null);getItemDetails(a,treeObject.get_node(c),function(){writeItemToTree(treeObject,treeObject.get_node(c)),displayItemInfo(treeObject.get_node(c).data),addLocalStorage(a)})}}function displayBooleanAsImage(a,b,c){return"undefined"==typeof a?"N/A":a?"<span class='glyphicon glyphicon-ok-sign infoHeaderIcon glyphiconGreen' title='"+b+"'></span>":"<span class='glyphicon glyphicon-remove-sign infoHeaderIcon glyphiconRed' title='"+c+"'></span>"}function convertCommaSeparatedTextToList(a){if(void 0==a|""===a)return"N/A";var b,c=a.split(",");return b="<ul>",c.forEach(function(a){b+="<li>"+a+"</li>"}),b+="</ul>"}function convertEsriDomainToList(a){if(void 0==a|""===a|"null"===a)return"N/A";var b="";switch(b+=a.name+" ("+a.type+")<br/>",a.type){case"codedValue":b+="<ul>",a.codedValues.forEach(function(a){b+="<li>"+a.name+" ("+a.code+")</li>"}),b+="</ul>";break;case"range":b+="Min: "+a.ranges.minValue+"<br/>",b+="Max: "+a.ranges.maxValue+"<br/>"}return b}function convertSubTypesDomainsToList(a){if(void 0==a|""===a|"null"===a)return"N/A";var b="<ul>";return Object.keys(a).forEach(function(c){b+="<li>",b+=c+" ("+a[c].type+")",b+="</li>"}),b+="</ul>"}function convertSubTypesTemplatesToList(a){if(void 0==a|""===a|"null"===a)return"N/A";var b="<ul>";return a.forEach(function(a){b+="<li><b>Name: </b>"+a.name+"</li>",b+="<li><b>Description: </b>"+a.description+"</li>",b+="<li><b>Drawing Tool: </b>"+convertEnumToString("esriFeatureEditTool",a.drawingTool)+"</li>",b+="<li><b>Prototype Attributes: </b></li><ul>",Object.keys(a.prototype.attributes).forEach(function(c){b+="<li>",b+=c+": "+a.prototype.attributes[c],b+="</li>"}),b+="</ul>"}),b+="</ul>"}function convertEnumToString(a,b){if(void 0==b|""===b)return"N/A";try{var c=$.grep(esriEnums,function(b){return b.type===a});if(0===c.length)return"N/A";var d=$.grep(c[0].values,function(a){return a.value===b});return 0===!d.length?"N/A":d[0].title?d[0].title:"N/A"}catch(e){}}function displayTextOrNA(a){return void 0===a|null===a|""===a?"N/A":a}function displayNumberOrNA(a){return void 0===a?"N/A":a}function getSpatialReferenceInfo(a){if(void 0===a)return"N/A";$.ajaxSetup({async:!1});var b;return $.getJSON("data/SRs/"+a+".json",function(c){b=c.name+" ("+a+")"}).fail(function(){b=a}),$.ajaxSetup({async:!0}),b}function getSymbolDetails(a){$.ajaxSetup({async:!1});var b;return $.get("templates/partial_Symbol.html",function(c){var d=Handlebars.compile(c);b=d(a)}),$.ajaxSetup({async:!0}),b}function getColorDetails(a){if(a){var b="rgb("+a[0]+","+a[1]+","+a[2]+")";return"<span class='colorCircle' style='background-color:"+b+";color:"+b+";'>&bull;</span>Red: "+a[0]+", Green: "+a[1]+", Blue: "+a[2]+", "+RgbToHex(a[0],a[1],a[2])+", Alpha: "+a[3]}return"N/A"}function RgbToHex(a,b,c){var d=returnHex(a),e=returnHex(b),f=returnHex(c);return"#"+d+e+f}function returnHex(a){return null==a?"00":(a=a.length<2?"0"+a:a,a.toString(16))}function getFullUrlOfSelectedNode(a){return treeObject.get_selected("#"+name_divTree,!0)[0].data.itemUrl+a}function ifequal(a,b,c){return a===b?c.fn(this):void 0}function beautifyJson(a){return JSON.stringify(a,null,"	")}function construct(a,b){function c(){return a.apply(this,b)}return c.prototype=a.prototype,new c}function ifEqualToAny(){for(var a=1;a<arguments.length-2;a++)if(arguments[0]==arguments[a])return arguments[arguments.length-1].fn(this)}function convertLegendObjectToString(a){var b="";return a.forEach(function(a){b+='<img title="'+a.contentType+'" src="data:'+a.contentType+";base64,"+a.imageData+'" /> '+displayTextOrNA(a.label)+" ("+a.width+", "+a.height+")<br/>"}),b}function getMapLegendDetails(a){var b=getUniqueElementName("mapLegnedId"),c='<div id="'+b+'"></div>';return $.getJSON(a+"/legend?f=json&callback=?",function(a){$("#"+b).html(generateTable(a.layers,'[{"name":"layerId", "title":"ID", "type":"number"}, {"name":"layerName","title":"Name","type":"text"}, {"name":"layerType", "title":"Type","type":"text"}, {"name":"minScale", "title":"Min Scale", "type":"number"}, {"name":"maxScale", "title":"Max Scale", "type":"number"}, {"name":"legend", "title":"Legend (width, height)", "type":"legend"}]',"No legend items."))}).fail(function(){$("#"+b).html("No legend items.")}),c}function generateTable(a,b,c){var d=JSON.parse(b);if("undefined"===a|"null"==a|0===a.length)return c;var e="<tr>";d.forEach(function(a){e+="<th>"+a.title+"</th>"}),e+="</tr>";var f="";return a.forEach(function(a){f+="<tr>",d.forEach(function(b){f+="<td>";var c;switch(b.type){case"text":c=displayTextOrNA(a[b.name]);break;case"boolean":c=displayBooleanAsImage(a[b.name],b.trueTitle,b.falseTitle);break;case"number":c=displayNumberOrNA(a[b.name]);break;case"enum":c=convertEnumToString(b.enumType,a[b.name]);break;case"esriDomain":c=convertEsriDomainToList(a[b.name]);break;case"esriSymbol":c=getSymbolDetails(a[b.name]);break;case"subTypesDomain":c=convertSubTypesDomainsToList(a[b.name]);break;case"subTypesTemplates":c=convertSubTypesTemplatesToList(a[b.name]);break;case"legend":c=convertLegendObjectToString(a[b.name]);break;default:c=displayTextOrNA(a[b.name])}f+=c,f+="</td>"}),f+="</tr>"}),"<table class='table table-striped table-hover'><thead>"+e+"</thead><tbody>"+f+"</tbody></table>"}function setupHandlebarsHelpers(){Handlebars.registerHelper("getFolderName",function(a){var b=a.split("/"),c=b[b.length-2];return c}),Handlebars.registerHelper("getServiceNameFromUrl",function(a){return getServiceNameFromUrl(a)}),Handlebars.registerHelper("getServiceNameFromAgsServiceName",function(a){return getServiceNameFromAgsServiceName(a)}),Handlebars.registerHelper("getServiceType",function(a){return getServiceType(a)}),Handlebars.registerHelper("getItemIcon",function(a,b){return getItemIcon(a,b)}),Handlebars.registerHelper("getServiceIconFromUrl",function(a,b){return getServiceIconFromUrl(a,b)}),Handlebars.registerHelper("displayBooleanAsImage",displayBooleanAsImage),Handlebars.registerHelper("displayTextOrNA",displayTextOrNA),Handlebars.registerHelper("displayNumberOrNA",displayNumberOrNA),Handlebars.registerHelper("convertCommaSeparatedTextToList",convertCommaSeparatedTextToList),Handlebars.registerHelper("convertEnumToString",convertEnumToString),Handlebars.registerHelper("getSpatialReferenceInfo",getSpatialReferenceInfo),Handlebars.registerHelper("getColorDetails",getColorDetails),Handlebars.registerHelper("generateTable",generateTable),Handlebars.registerHelper("ifequal",ifequal),Handlebars.registerHelper("getFullUrlOfSelectedNode",getFullUrlOfSelectedNode),Handlebars.registerHelper("json-stringify",JSON.stringify),Handlebars.registerHelper("json-beautify",beautifyJson),Handlebars.registerHelper("ifEqualToAny",ifEqualToAny),Handlebars.registerHelper("getMapLegendDetails",getMapLegendDetails)}function setupHandlebarsPartials(){$.get("templates/partial_Extent.html",function(a){Handlebars.registerPartial("extentDetails",a)}),$.get("templates/partial_SpatialReference.html",function(a){Handlebars.registerPartial("spatialReferenceDetails",a)}),$.get("templates/partial_ExtentPreviewIcon.html",function(a){Handlebars.registerPartial("extentPreviewIcon",a)}),$.get("templates/partial_ServiceInfoHeader.html",function(a){Handlebars.registerPartial("serviceInfoHeader",a)}),$.get("templates/partial_Renderer.html",function(a){Handlebars.registerPartial("rendererDetails",a)}),$.get("templates/partial_Symbol.html",function(a){Handlebars.registerPartial("symbolDetails",a)}),$.get("templates/partial_LabelingInfo.html",function(a){Handlebars.registerPartial("labelingInfoDetails",a)})}function displayItemInfo(a){$.get(getTemplatePath(a.itemType),function(b){var c=Handlebars.compile(b),d=c(a);$("#"+name_divInfo).html(d),$("pre code").each(function(a,b){hljs.highlightBlock(b)}),$(".bstooltip").tooltip(),$("#progressBar").html("")})}function addLocalStorage(a){"undefined"!=typeof Storage&&(localStorage.AGS_servicesUrl||-1!=list_defaultSampleServers.indexOf(a)?-1==JSON.parse(localStorage.AGS_servicesUrl.indexOf(a))&&-1==list_defaultSampleServers.indexOf(a)&&(url_localStorageList=JSON.parse(localStorage.AGS_servicesUrl),url_localStorageList.push(a),localStorage.setItem("AGS_servicesUrl",JSON.stringify(url_localStorageList))):(url_localStorageList.push(a),localStorage.setItem("AGS_servicesUrl",JSON.stringify(url_localStorageList))))}var treeObject,esriEnums,name_divInfo="infoPanel",name_txtServerUrl="txtServerUrl",name_divTree="treeDiv",name_btnEsriSampleServer="esriSampleServerButton",name_ulEsriSampleServer="esriSampleServersList",list_defaultSampleServers=[],url_localStorageList=[],elementIdCounter=1;String.prototype.endsWith=function(a){return-1!==this.indexOf(a,this.length-a.length)},$("#treeDiv").on("hover_node.jstree",function(a,b){$("#"+b.node.id).attr("style","color: red;")}),$("#treeDiv").on("dehover_node.jstree",function(a,b){$("#"+b.node.id).removeAttr("style")}),$(document).ready(function(){setupHandlebarsHelpers(),setupHandlebarsPartials(),treeObject=$.jstree.create("#"+name_divTree,{core:{check_callback:!0}}),$("#"+name_divTree).on("select_node.jstree",function(a,b){$("#progressBar").html("<div class='progress infoPanelLoading'><div class='progress-bar progress-bar-info progress-bar-striped active'  role='progressbar' aria-valuenow='95' aria-valuemin='0' aria-valuemax='100' style='width: 95%'><span class='sr-only'>Loading...</span></div></div>"),getItemDetails(b.node.data.itemUrl,b.node,function(){0==b.node.children.length&&(writeItemToTree(treeObject,b.node),b.node.state.opened=!0),displayItemInfo(b.node.data)})}),$.getJSON("data/esriSampleServers.json",function(a){$.each(a.servers,function(a,b){list_defaultSampleServers.push(b.url)}),$.get("templates/esriSampleServersList.html",function(b){var c=Handlebars.compile(b),d=c(a);$("#"+name_ulEsriSampleServer).html(d),$("."+name_btnEsriSampleServer).click(function(){setServerUrl($(this).attr("data-serverUrl"))})})}),$.getJSON("data/esriEnums.json",function(a){esriEnums=a}),localStorage.AGS_servicesUrl&&$.each(JSON.parse(localStorage.AGS_servicesUrl),function(a,b){btnGetServerInfo_Click(b)})}),$("#txtServerUrl").keyup(function(a){13==a.which&&$("#btnGetServerInfo").click()});